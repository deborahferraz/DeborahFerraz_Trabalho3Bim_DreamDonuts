<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pagamento - Dream Donuts</title>
  <link rel="stylesheet" href="/loja/style.css" />
  <link rel="stylesheet" href="pagamento.css" />
  <!-- Biblioteca QR Code correta -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
</head>
<body>
<header class="header">
  <div class="container">
    <div class="logo"><h1>üç© Dream Donuts - Pagamento</h1></div>
    <nav class="nav">
      <a href="/loja/index.html" class="btn-back">‚Üê Voltar √† Loja</a>
    </nav>
  </div>
</header>

<main class="main">
  <div class="container">
    <div class="payment-container">
      <!-- Resumo do Pedido -->
      <div class="order-summary">
        <h2>Resumo do Pedido</h2>
        <div id="orderItems" class="order-items"></div>
        <div class="order-total">
          <strong>Total: R$ <span id="orderTotal">0,00</span></strong>
        </div>
      </div>

      <!-- Formul√°rio de Pagamento -->
      <div class="payment-form">
        <h2>Dados do Pagamento</h2>
        
        <!-- Informa√ß√£o de Endere√ßo -->
        <div id="addressInfo" class="address-info" style="display: none;">
          <div class="form-group">
            <label>üì¶ Endere√ßo Cadastrado:</label>
            <div id="savedAddress"></div>
            <button type="button" id="btnChangeAddress" class="btn-change">
              Usar outro endere√ßo
            </button>
          </div>
        </div>

        <form id="paymentForm">
          <div id="addressFields" class="form-group">
            <label for="deliveryAddress">Endere√ßo de Entrega:</label>
            <textarea id="deliveryAddress" rows="3" placeholder="Digite seu endere√ßo completo (rua, n√∫mero, bairro, cidade, estado)" required></textarea>
            <small style="color: #666;">Se voc√™ j√° tem um endere√ßo cadastrado, ele ser√° carregado automaticamente.</small>
          </div>

          <div class="form-group">
            <label for="paymentMethod">Forma de Pagamento:</label>
            <select id="paymentMethod" required>
              <option value="">Selecione...</option>
              <option value="cartao_credito">Cart√£o de Cr√©dito</option>
              <option value="cartao_debito">Cart√£o de D√©bito</option>
              <option value="pix">PIX</option>
              <option value="dinheiro">Dinheiro</option>
            </select>
          </div>

          <div id="cardFields" class="card-fields" style="display: none;">
            <div class="form-group">
              <label for="cardNumber">N√∫mero do Cart√£o:</label>
              <input type="text" id="cardNumber" placeholder="0000 0000 0000 0000" maxlength="19">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="cardExpiry">Validade:</label>
                <input type="text" id="cardExpiry" placeholder="MM/AA" maxlength="5">
              </div>
              <div class="form-group">
                <label for="cardCvv">CVV:</label>
                <input type="text" id="cardCvv" placeholder="123" maxlength="4">
              </div>
            </div>
            
            <div class="form-group">
              <label for="cardName">Nome no Cart√£o:</label>
              <input type="text" id="cardName" placeholder="Nome como est√° no cart√£o">
            </div>
          </div>

          <div id="pixFields" class="pix-fields" style="display: none;">
            <div class="pix-info">
              <p>üí° <strong>Pagamento PIX</strong> - Ap√≥s confirmar o pedido, ser√° gerado um QR Code com o valor exato do seu pedido.</p>
              <p style="font-size: 0.9rem; color: #666;">O valor ser√° preenchido automaticamente no app do seu banco.</p>
            </div>
          </div>

          <div id="cashFields" class="cash-fields" style="display: none;">
            <div class="form-group">
              <label for="cashAmount">Valor para Troco (opcional):</label>
              <input type="number" id="cashAmount" step="0.01" min="0" placeholder="Ex: 50.00">
            </div>
          </div>

          <div class="form-group">
            <label for="orderNotes">Observa√ß√µes (opcional):</label>
            <textarea id="orderNotes" rows="2" placeholder="Alguma observa√ß√£o especial?"></textarea>
          </div>

          <div class="payment-actions">
            <button type="button" class="btn-cancel" onclick="voltarCarrinho()">Cancelar</button>
            <button type="submit" class="btn-confirm">Confirmar Pedido</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<!-- Modal de Confirma√ß√£o -->
<div id="modalConfirmacao" class="modal">
  <div class="modal-content">
    <h3>Pedido Confirmado!</h3>
    <p id="modalMessage">Seu pedido foi realizado com sucesso!</p>
    
    <!-- √Årea do PIX com QR Code -->
    <div id="pixCode" class="pix-code" style="display: none;">
      <div class="pix-header">
        <h4>üí∞ Pagamento via PIX</h4>
        <p>Escaneie o QR Code abaixo - o valor de <strong>R$ <span id="pixAmount">0,00</span></strong> j√° est√° pr√©-definido!</p>
      </div>
      
      <div class="pix-amount">
        <strong>Valor: R$ <span id="pixAmountDisplay">0,00</span></strong>
      </div>
      
      <div class="qrcode-container">
        <div id="qrcode"></div>
      </div>
      
      <div class="pix-details">
        <div class="pix-info-item">
          <strong>Chave PIX:</strong>
          <span>44997353860</span>
        </div>
        <div class="pix-info-item">
          <strong>Nome:</strong>
          <span>Deborah Ferraz Pontes</span>
        </div>
        <div class="pix-info-item">
          <strong>Valor:</strong>
          <span>R$ <span id="pixValueDisplay">0,00</span></span>
        </div>
        <div class="pix-info-item">
          <strong>Banco:</strong>
          <span>Inter</span>
        </div>
        <div class="pix-info-item">
          <strong>Cidade:</strong>
          <span>Peabiru - PR</span>
        </div>
      </div>
      
      <div class="pix-copy-section">
        <p><strong>C√≥digo PIX Copia e Cola (j√° com o valor):</strong></p>
        <div class="pix-code-display">
          <code id="pixCodeText"></code>
          <button onclick="copiarPix()" class="btn-copy">Copiar</button>
        </div>
      </div>
      
      <div style="margin-top: 1rem; padding: 1rem; background: #e8f5e8; border-radius: 8px; border: 1px solid #4a7c59;">
        <p style="margin: 0; color: #2d4a2d; font-size: 0.9rem;">
          <strong>‚úÖ Pronto!</strong> O QR Code acima j√° cont√©m o valor exato do seu pedido. Basta escanear com seu app banc√°rio.
        </p>
      </div>
    </div>
    
    <button onclick="fecharModal()" class="btn-ok">OK</button>
  </div>
</div>
<div id="modalOverlay" class="modal-overlay" onclick="fecharModal()"></div>

<script src="pagamento.js"></script>
</body>
</html>