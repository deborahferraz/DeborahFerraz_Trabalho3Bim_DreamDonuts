<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administra칞칚o - Donut Shop</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>游꼴 Donut Shop - Admin</h1>
            </div>
            
            <nav class="nav">
                <div class="user-info">
                    <span id="nomeUsuario">Carregando...</span>
                    <button id="btnLogout" class="btn-logout">Sair</button>
                </div>
                
                <a href="../loja/index.html" class="btn-loja">游 Ir para Loja</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <h2>Painel de Administra칞칚o</h2>
            
            <!-- Menu de CRUDs -->
            <div class="crud-menu">
                <div class="crud-card" onclick="abrirCrud('categorias')">
                    <div class="crud-icon">游늭</div>
                    <h3>Categorias</h3>
                    <p>Gerenciar categorias de produtos</p>
                </div>
                
                <div class="crud-card" onclick="abrirCrud('produto')">
                    <div class="crud-icon">游꼴</div>
                    <h3>Produtos</h3>
                    <p>Gerenciar donuts e produtos</p>
                </div>
                
                <div class="crud-card" onclick="abrirCrud('usuarios')">
                    <div class="crud-icon">游논</div>
                    <h3>Usu치rios</h3>
                    <p>Gerenciar usu치rios do sistema</p>
                </div>
                
                <div class="crud-card" onclick="abrirCrud('pedidos')">
                    <div class="crud-icon">游늶</div>
                    <h3>Pedidos</h3>
                    <p>Gerenciar pedidos e itens</p>
                </div>
                
                <div class="crud-card" onclick="abrirCrud('enderecos')">
                    <div class="crud-icon">游</div>
                    <h3>Endere칞os</h3>
                    <p>Gerenciar endere칞os dos usu치rios</p>
                </div>
                
                <div class="crud-card" onclick="abrirCrud('formas-pagamento')">
                    <div class="crud-icon">游눱</div>
                    <h3>Formas de Pagamento</h3>
                    <p>Gerenciar formas de pagamento</p>
                </div>

                <!-- NOVO: Relat칩rios -->
                <div class="crud-card" onclick="abrirRelatorios()">
                    <div class="crud-icon">游늵</div>
                    <h3>Relat칩rios</h3>
                    <p>Relat칩rios gerenciais e vendas</p>
                    <small>NOVO</small>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE_URL = "http://localhost:3001";
        let usuarioLogado = null;

        document.addEventListener("DOMContentLoaded", async () => {
            await verificarLogin();
        });

        // -------- VERIFICAR LOGIN --------
        async function verificarLogin() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/verificar`, {
                    credentials: "include",
                });
                const data = await response.json();

                if (data.logged) {
                    usuarioLogado = data;
                    document.getElementById("nomeUsuario").textContent = `Bem-vindo, ${data.nome_usuario}!`;
                    
                    // Verificar se 칠 admin
                    if (data.papel !== 'admin') {
                        alert('Acesso negado. Apenas administradores podem acessar o painel.');
                        window.location.href = "../loja/index.html";
                    }
                } else {
                    usuarioLogado = null;
                    document.getElementById("nomeUsuario").textContent = "N칚o autenticado";
                    alert('Voc칡 precisa estar logado para acessar o painel.');
                    window.location.href = "../auth/login.html";
                }
            } catch (error) {
                console.error("Erro ao verificar login:", error);
            }
        }

        // -------- ABRIR CRUD --------
        function abrirCrud(pagina) {
            window.location.href = `../${pagina}/${pagina}.html`; 
        }

        // -------- ABRIR RELAT칍RIOS --------
        function abrirRelatorios() {
            window.location.href = `../relatorios/relatorios.html`;
        }

        // -------- LOGOUT --------
        document.getElementById("btnLogout").addEventListener("click", async () => {
            await fetch(`${API_BASE_URL}/auth/logout`, { method: "POST", credentials: "include" });
            window.location.href = "../loja/index.html";
        });
    </script>
</body>
</html>